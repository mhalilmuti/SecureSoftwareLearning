<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <title>Master BMS</title>
    <meta name="description" content="Master BSM" />

    <meta name="viewport" content="width=1000, initial-scale=1.0, maximum-scale=1.0">

    <!-- Loading Sweet Alert -->
    <script src="./js/sweetalert.min.js"></script>
    <link rel="stylesheet" type="text/css" href="./css/sweetalert.css">
    <!-- Loading Bootstrap -->
    <link href="./css/vendor/bootstrap/css/bootstrap.min.css" rel="stylesheet">

    <!-- Loading Flat UI -->
    <link href="./css/flat-ui.css" rel="stylesheet">
    <link href="./css/demo.css" rel="stylesheet">

    <link rel="shortcut icon" href="img/lionking.ico">

    <!-- HTML5 shim, for IE6-8 support of HTML5 elements. All other JS at the end of file. -->
    <!--[if lt IE 9]>
      <script src="dist/js/vendor/html5shiv.js"></script>
      <script src="dist/js/vendor/respond.min.js"></script>
    <![endif]-->
    <script>
        function init() { //sayfa yuklenirken calisacak

            var kategori = [];
            var xmlhttp = new XMLHttpRequest();
            xmlhttp.open("GET", "http://localhost:54250/api/Category", true);
            xmlhttp.setRequestHeader("Content-Type", "application/json");
            xmlhttp.setRequestHeader("Accept", "*/*");
            try {
                xmlhttp.onload = function () {
                    if (xmlhttp.readyState === xmlhttp.DONE) {
                        if (xmlhttp.status === 200) {
                            var list = JSON.parse(xmlhttp.response);
                            for (var a = 0; a < list.length; a++) {
                                kategori.push({ id: list[a].id, name: list[a].name })
                            }
                            var ul = document.getElementById("list");
                            //   kategori = [{ name: "Deneme", id: 1 }, { name: "Ornek", id: 2 }]
                            for (a = 0; a < kategori.length; a++) {  //BE den çekilen kategorler listeleniyor
                                var li = document.createElement("li");
                                li.appendChild(document.createTextNode("Four"));
                                li.setAttribute("name", "kategori");
                                li.setAttribute("onclick", "katesec(this)");
                                li.setAttribute("id", kategori[a].id.toString()); // added line
                                li.innerHTML = `  <div class="todo-icon fui-arrow-right"></div>
                <div class="todo-content">
                  <h4 class="todo-name">
                     `+ kategori[a].name + `
                  </h4>
                </div>`;
                                ul.appendChild(li);
                            }
                        }
                    }
                };
                xmlhttp.send(null);
            } catch (e) {
                swal("Hata", "Lütfen Daha sonra tekrar deneyiniz", "error");
            }


        }
        function not() {
            swal({
                title: "Sayfa görüntülenemiyor!",
                text: "<img style='width:420px; height:240px;' src='img/yapim.jpg'>",
                html: true
            });
        }
        function satinal(prodid, amount) { //ürün satin alma
            //   api/Shopping/Transaction/Create
            /*{
               "customerId": "sample string 1",
               "productId": 2,
               "totalAmount": "sample string 3"
           }*/
            var xmlhttp = new XMLHttpRequest();
            xmlhttp.open("POST", "http://localhost:54250/api/Shopping/Transaction/Create", true);
            xmlhttp.setRequestHeader("Content-Type", "application/json");
            xmlhttp.setRequestHeader("Accept", "*/*");
            try {
                xmlhttp.onload = function () {
                    if (xmlhttp.readyState === xmlhttp.DONE) {
                        if (xmlhttp.status === 200) {
                            swal("Alış Veriş Onaylandı", "Siparişiniz En kısa zamanda kargoya verilecektir.", "success");
                        }
                    }
                };

                xmlhttp.send(JSON.stringify({
                    customerId: localStorage.getItem("id"),
                    productId: parseInt(prodid),
                    totalAmount: amount
                }));
            } catch (e) {
                swal("Sipariş Başarısız", "Lütfen Daha sonra tekrar deneyiniz", "error");
            }

        }
        function katesec(element) { //kategori seçilmesinde kullanılacak
            var kategoriler = document.getElementsByName("kategori");
            for (a = 0; a < kategoriler.length; a++) { //secilen kategori dişindakileri  kapat
                if (element != kategoriler[a]) {
                    kategoriler[a].className = "";
                }
            }

            var Urun = [];
            var xmlhttp = new XMLHttpRequest();
            xmlhttp.open("GET", "http://localhost:54250/api/Product/" + element.id, true);
            xmlhttp.setRequestHeader("Content-Type", "application/json");
            xmlhttp.setRequestHeader("Accept", "*/*");
            try {
                xmlhttp.onload = function () {
                    if (xmlhttp.readyState === xmlhttp.DONE) {
                        if (xmlhttp.status === 200) {
                            var list = JSON.parse(xmlhttp.response);
                            for (var a = 0; a < list.length; a++) {
                                Urun.push({ id: list[a].id, name: list[a].name, amount: list[a].amount })
                            }
                            var ul = document.getElementById("list");
                            urunlistele = document.getElementById("urunler");
                            urunlistele.innerHTML = "";
                            if (Urun.length == 0) {
                                urunlistele.innerHTML = `
                 <div class="demo-headline">
                    <img style='border-radius: 6px 6px;' src='img/productnotfound.png'>
                    <h4>
                    Aranığınız Kategoride Ürün Bulunamadı!
                    </h4>
                </div>`;
                            } else {

                                for (b = 0; b < Urun.length; b++) {
                                    urunlistele.innerHTML += `<div class="col-xs-3">
                    <div class="tile">
                        <img src="img/icons/svg/paper-bag.svg" alt="Ürün Resmi" class="tile-image big-illustration">
                        <h3 class="tile-title">`+ Urun[b].name + `</h3>
                        <p>`+ Urun[b].amount + ` tl</p>
                        <a class="btn btn-inverse btn-large btn-block" href="javascript:void(0)" onclick="satinal(`+ Urun[b].id + `,'` + Urun[b].amount + `')">Satın Al</a>
                        </div>
                    </div>`;
                                }

                            }

                        }
                    }
                };
                xmlhttp.send(null);
            } catch (e) {
                swal("Hata", "Lütfen Daha sonra tekrar deneyiniz", "error");
            }

        }
        function alisveris() {
            location.href = "shopping.html";
        }
        function cikis() {
            location.href = "index.html";
        }
        function profil() {
            location.href = "profile.html";
        }
    </script>
</head>
<body onload="init()" style="background-color: #1abc9c;">
<div class="col-xs-12">
    <nav class="navbar navbar-inverse navbar-embossed" role="navigation">
        <div class="navbar-header">
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#navbar-collapse-01">
                <span class="sr-only">Master BMS</span>
              </button>
            <a class="navbar-brand" href="customerdasboard.html"><img style="margin-top: -12px;width: 50px;" src=".\img\lionking.ico"></a>
</div>
<div class="collapse navbar-collapse" id="navbar-collapse-01">
    <ul class="nav navbar-nav navbar-left">
        <li>
            <a href="javascript:void(0)" onclick="alisveris()"href="">Alış verişe Başla</a>
</li>
<li>
    <a href="javascript:void(0)" onclick="not()">Siparişlerim </a>
</li>
<li>
    <a href="javascript:void(0)" onclick="profil()">Profil </a>
</li>
</ul>
<form class="navbar-form navbar-right" action="javascript:not();" role="search">
    <div class="form-group">
        <div class="input-group">
            <input class="form-control" id="navbarInput-01" type="search" placeholder="Arama">
            <span class="input-group-btn">
                      <button type="submit" class="btn"><span class="fui-search"></span></button>
            </span>
        </div>
    </div>
    <div class="form-group">
        <button type="button" onclick="profil()" style="color: #ffffff; background-color: #3498db;" class="btn"> <span class="fui-user"></span>
<script>  document.write(localStorage.getItem("name"));</script>
</button>
</div>
<div class="form-group">
    <button type="button" onclick="cikis()" class="btn"> <span class="fui-exit"></span> Çıkış</button>
</div>
</form>
</div>
<!-- /.navbar-collapse -->
</nav>
<div class="demo-browser">
    <div class="row demo-samples">
        <div class="col-xs-3">
            <div class="todo">
                <div class="todo-search">
                    <input class="todo-search-field" type="search" value="" placeholder="Arama">
                </div>
                <ul id="list">
                    <!-- /KATEGORI BE den çekilip listelenek -->
                </ul>
            </div>
            <!-- /.todo -->
        </div>
        <!-- /.col-xs-4 -->

        <div class="col-xs-8">
            <div id="urunler" class="row demo-tiles">
                <div class="demo-headline">
                    <img style='border-radius: 6px 6px; width:420px; height:240px;' src='img/choose.jpg'>
<h4>
    Lütfen Bir Kategori Seçiniz
</h4>
</div>

</div>
</div>
</div>



</div>


</div>



<script src="js/vendor/jquery.min.js"></script>
<script src="js/vendor/video.js"></script>
<script src="js/flat-ui.min.js"></script>
<script src="js/application.js"></script>

<script>
                                       videojs.options.flash.swf = "dist/js/vendors/video-js.swf"
</script>
</body>

</html>